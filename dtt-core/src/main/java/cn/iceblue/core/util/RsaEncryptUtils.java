package cn.iceblue.core.util;


import cn.iceblue.core.exception.DttException;
import lombok.extern.slf4j.Slf4j;

import javax.crypto.Cipher;
import java.io.ByteArrayOutputStream;
import java.nio.charset.StandardCharsets;
import java.security.*;
import java.security.interfaces.RSAPrivateKey;
import java.security.interfaces.RSAPublicKey;
import java.security.spec.PKCS8EncodedKeySpec;
import java.security.spec.X509EncodedKeySpec;
import java.time.Duration;
import java.time.Instant;
import java.util.Base64;

/**
 * Rsa非对称加密解密工具类<br/>
 * 前后端加密解密统一工具类
 *
 * @author : IceBlue
 * @date : 2023/6/14 16:57
 **/
@Slf4j
public class RsaEncryptUtils {

    private static final Base64.Decoder decoder = Base64.getDecoder();
    private static final Base64.Encoder encoder = Base64.getEncoder();

    /**
     * 全局默认公钥
     **/
    private final static String PUBLIC_KEY = "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqUAhn9Q0j3IWXBQLIGKW\n" + "FzFpQZu6DhGJS5OMCsY44wowDuzvfl3uR8uO1yEsvN7hAoCCgVjm3qzInMVfQghi\n" + "KWaf1G30I80atnmoqlB40bZudsYec5jbTf9fKqepVJrjClqLQ5CMmoeYCUSfKDOi\n" + "wfiRybm+D8zCwy9lbYzLQodrCpXAV/geJ3rsvOdBHkE/BdEYe3rnVkPHHOLPUMYx\n" + "5g8at6eFZtys0KbzeCHnWkpenzxGf577w4AhxpxF0riWumeRGXKfvn5Rf8wagn0M\n" + "Lvu7M0ST70tuKqbW7VoDZGQPQ7O++HlTRwg+Az8esGw59EfABJi55gSZrR1ApTtO\n" + "CwIDAQAB";

    /**
     * 全局默认私钥
     **/
    private final static String PRIVATE_KEY = "MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCpQCGf1DSPchZcFAsgYpYXMWlBm7oOEYlLk4wKxjjjCjAO7O9+Xe5Hy47XISy83uECgIKBWOberMicxV9CCGIpZp/UbfQjzRq2eaiqUHjRtm52xh5zmNtN/18qp6lUmuMKWotDkIyah5gJRJ8oM6LB+JHJub4PzMLDL2VtjMtCh2sKlcBX+B4neuy850EeQT8F0Rh7eudWQ8cc4s9QxjHmDxq3p4Vm3KzQpvN4IedaSl6fPEZ/nvvDgCHGnEXSuJa6Z5EZcp++flF/zBqCfQwu+7szRJPvS24qptbtWgNkZA9Ds774eVNHCD4DPx6wbDn0R8AEmLnmBJmtHUClO04LAgMBAAECggEAZjNZmn+zdWM46UUZKucdJsgpfPqiMNiaBU8FY4Qq2b5PItQkEjR6LFRY3sMjlrEnQjGDnMOoNZI0WaY9TUxuqf1UShxTLkMt/D4egSmyqz/0GDiuLrOAyeqI9uLjNzmIG7ptGdFxdeanAgGz8bysbWDB+AP3JudIPECkiLBaFMNhLlPXpSoViS57zP5VJ5hi7ZSY6C2sBhkJkJ2v3Nt+raQPS/6GwUeFV31dqBo+XwvxhORu5Y73Bn6ubRU6/1LrcwaQmVIByn6VYHvJEDBHW1WsZ9ux2fGGRa9dR3H8XsOiGYwzzPTsPS+AyWg84LrlJYEE+iK3lP/Ahwy7qwBvAQKBgQDcVAK653GD4hpunu2sqkxdZUBa+u6+XuWSHe3DNc0bnSFqAWkqNmuFAeNfp4m5Pp95dZqc8qGs7ooXra9bE1A8Y/SYViTuEZO74XyCMolgF+iipf9IqcsbjL7IkG/M1ecbkfdgfJauwQpiwrKMJqaw2ResVqQCbFMQ0Kez8mbqQQKBgQDEpxgWKV6lbZmyes18qSwzL+6dGdSmLf9WHnCPrdwfUi/pqebuRGqKTzf79Frqp7DyRrCol+jtWWGZJunWV1l7fBJ1UNN2rQfF3pQNPoQWNVekWQBZtl/i5CXnykhjciQxcE62bXErqGu2HWP4x3yAp74rYxLw8mT4yzEn45dtSwKBgQCnzHOn1MxnHLP0u6VXcvtlxc8VezaIVc2RUqnZmgfzl9/y09A8DeYlDiMUnowNQNxDrIVsMn1fLuyMzAJY4oSg+Z82xaSqi0hwNnKU1dg6Dvtlo/agaG//M1m5dgcvgVjZbnlwSnKX9Pzr6kwA4Q7icPPOlM2j6sv4anDOYzZuAQKBgQCunCtP6jXGr3VsO4vfZ5r+bE3zom7liywP/IE3okk0alZupFSPNaJf4o00Izji6Di+NrQ/Tnsc3GNDiIDSt8aVVYpSLo1E78haEhLlW6AO1BhYrkoYXk3veWKK2FrEKiIm37CUXMLC4A2bq6cLy50p40eA4Lx9wsyS+GBSKcxX1wKBgHJOZ0o31LPKl1Cj8numz8+q3wCFTUT/TLzUh0H8KfjwCFWcie4Al+anp+o+niQzuJNl3qgzMR1umnJUED2ylb4JTZAZ851yxt1l+yx0lxSg5sX58etPOvXICtSXNWF/DjlI+qpZxaYU1vpDDb/jy8npXioEjT1l9eYPD03A1eyB";

    private static final int MAX_ENCRYPT_BLOCK = 245;
    private static final int MAX_DECRYPT_BLOCK = 256;

    public static void main(String[] args) throws Exception {
        //生成公钥和私钥
        //genKeyPair();
        //加密字符串
        String message = "<ClinicalDocument xmlns=\"urn:hl7-org:v3\" xmlns:mif=\"urn:hl7-org:v3/mif\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"urn:hl7-org:v3 ..\\sdschemas\\SDA.xsd\">\n" + "  <!--地域代码,\"CN\" 代表中国-->\n" + "  <realmCode code=\"CN\" cnName=\"地域代码\"/>\n" + "  <!--文档注册模型-->\n" + "  <typeId extension=\"POCD_MT000040\" root=\"2.16.840.1.113883.1.3\" cnName=\"文档注册模型\"/>\n" + "  <!--文档模板编号OID-->\n" + "  <templateId root=\"2.16.156.10011.2.1.1.21\" cnName=\"文档模板编号\"/>\n" + "  <!--文档流水号标识 取java.util.UUID.randomUUID().toString()-->\n" + "  <id extension=\"\" root=\"2.16.156.10011.1.1\" cnName=\"文档流水号标识\"/>\n" + "  <!--用来说明记录文档的类型-->\n" + "  <code code=\"C0001\" codeSystem=\"2.16.156.10011.2.4\" codeSystemName=\"卫生信息共享文档规范编码体系\" cnName=\"文档类型\"/>\n" + "  <!--文档标题-->\n" + "  <title cnName=\"文档标题\">病历概要</title>\n" + "  <!--文档机器生成时间,取new Date()-->\n" + "  <effectiveTime value=\"\" cnName=\"文档机器生成时间\"/>\n" + "  <!--文档密级代码-->\n" + "  <confidentialityCode code=\"N\" codeSystem=\"2.16.840.1.113883.5.25\" codeSystemName=\"Confidentiality\" displayName=\"正常访问保密级别\" cnName=\"文档密级代码\"/>\n" + "  <!--文档语言类型编码-->\n" + "  <languageCode code=\"zh-CN\" cnName=\"文档语言类型编码\"/>\n" + "  <setId cnName=\"文档集合编号\"/>\n" + "  <versionNumber cnName=\"文档版本号\"/>\n" + "  <!--文档记录对象或健康保健对象-->\n" + "  <recordTarget contextControlCode=\"OP\" typeCode=\"RCT\" cnName=\"文档记录对象\">\n" + "    <!--患者角色-->\n" + "    <patientRole classCode=\"PAT\" cnName=\"患者角色\">\n" + "      <!--健康档案标识号-->\n" + "      <id extension=\"$VW_HLHT_BLGY_HZJBXX.jkdabh\" root=\"2.16.156.10011.1.2\" cnName=\"健康档案标识号\"/>\n" + "      <!--健康卡号-->\n" + "      <id extension=\"$VW_HLHT_BLGY_HZJBXX.jkkh\" root=\"2.16.156.10011.1.19\" cnName=\"健康卡号\"/>\n" + "      <!--患者家庭住址-->\n" + "      <addr use=\"H\" cnName=\"患者家庭住址\">\n" + "        <houseNumber cnName=\"地址-门牌号码\">$VW_HLHT_BLGY_HZJBXX.dzmphm</houseNumber>\n" + "        <streetName cnName=\"现住地址-村（街、路、弄等）\">$VW_HLHT_BLGY_HZJBXX.dzc</streetName>\n" + "        <township cnName=\"地址-乡（镇、街道办事处）\">$VW_HLHT_BLGY_HZJBXX.dzxz</township>\n" + "        <county cnName=\"地址-县（区）\">$VW_HLHT_BLGY_HZJBXX.dzx</county>\n" + "        <city cnName=\"地址-市（地区）\">$VW_HLHT_BLGY_HZJBXX.dzsq</city>\n" + "        <state cnName=\"地址-省（自治区、直辖市）\">$VW_HLHT_BLGY_HZJBXX.dzsf</state>\n" + "        <postalCode quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_HZJBXX.yzbm\" cnName=\"邮政编码\">$VW_HLHT_BLGY_HZJBXX.yzbm</postalCode>\n" + "      </addr>\n" + "      <!--患者联系电话-->\n" + "      <telecom quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_HZJBXX.hzdhhm\" value=\"$VW_HLHT_BLGY_HZJBXX.hzdhhm\" cnName=\"患者联系电话\"/>\n" + "      <!--患者个人基本信息-->\n" + "      <patient classCode=\"PSN\" determinerCode=\"INSTANCE\" cnName=\"患者个人基本信息\">\n" + "        <!--患者身份证号-->\n" + "        <id extension=\"$VW_HLHT_BLGY_HZJBXX.sfzhm\" root=\"2.16.156.10011.1.3\" cnName=\"患者身份证号\"/>\n" + "        <!--患者姓名-->\n" + "        <name cnName=\"患者姓名\">$VW_HLHT_BLGY_HZJBXX.hzxm</name>\n" + "        <!--患者性别-->\n" + "        <administrativeGenderCode code=\"$VW_HLHT_BLGY_HZJBXX.xbdm\" codeSystem=\"2.16.156.10011.2.3.3.4\" codeSystemName=\"生理性别代码表(GB/T 2261.1)\" displayName=\"$VW_HLHT_BLGY_HZJBXX.xbmc\" cnName=\"患者性别\"/>\n" + "        <!--患者出生日期-->\n" + "        <birthTime value=\"$VW_HLHT_BLGY_HZJBXX.csrq$\" cnName=\"患者出生日期\"/>\n" + "        <!--患者婚姻状况-->\n" + "        <maritalStatusCode code=\"$VW_HLHT_BLGY_HZJBXX.hyzkdm\" codeSystem=\"2.16.156.10011.2.3.3.5\" codeSystemName=\"婚姻状况代码表(GB/T 2261.2)\" displayName=\"$VW_HLHT_BLGY_HZJBXX.hyzkmc\" cnName=\"患者婚姻状况\"/>\n" + "        <!--民族-->\n" + "        <ethnicGroupCode code=\"$VW_HLHT_BLGY_HZJBXX.mz\" codeSystem=\"2.16.156.10011.2.3.3.3\" codeSystemName=\"民族类别代码表(GB 3304)\" displayName=\"$VW_HLHT_BLGY_HZJBXX.mzmc\" cnName=\"民族\"/>\n" + "        <!--患者工作单位-->\n" + "        <employerOrganization quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_HZJBXX.gzdw;VW_HLHT_BLGY_HZJBXX.gzdwhm\" cnName=\"患者工作单位\">\n" + "          <name cnName=\"工作单位名称\">$VW_HLHT_BLGY_HZJBXX.gzdw</name>\n" + "          <telecom value=\"$VW_HLHT_BLGY_HZJBXX.gzdwhm\" cnName=\"工作单位电话\"/>\n" + "        </employerOrganization>\n" + "        <!--患者职业状况-->\n" + "        <occupation quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_HZJBXX.zylb;VW_HLHT_BLGY_HZJBXX.zymc\" cnName=\"患者职业状况\">\n" + "          <occupationCode code=\"$VW_HLHT_BLGY_HZJBXX.zylb\" codeSystem=\"2.16.156.10011.2.3.3.13\" codeSystemName=\"从业状况(个人身体)代码表(GB/T 2261.4)\" displayName=\"$VW_HLHT_BLGY_HZJBXX.zymc\" cnName=\"患者职业状况\"/>\n" + "        </occupation>\n" + "      </patient>\n" + "    </patientRole>\n" + "  </recordTarget>\n" + "  <!--文档创作者 -->\n" + "  <author contextControlCode=\"OP\" typeCode=\"AUT\" cnName=\"文档创作者\">\n" + "    <!--建档日期时间-->\n" + "    <time value=\"$VW_HLHT_BLGY_HZJBXX.jdrqsj$\" cnName=\"建档日期时间\"/>\n" + "    <!--指定创作者-->\n" + "    <assignedAuthor classCode=\"ASSIGNED\" cnName=\"指定创作者\">\n" + "      <id extension=\"$VW_HLHT_BLGY_HZJBXX.jdzbm\" root=\"2.16.156.10011.1.7\" cnName=\"作者的唯一标识符\"/>\n" + "      <assignedPerson>\n" + "        <name cnName=\"建档者姓名\">$VW_HLHT_BLGY_HZJBXX.jdzxm</name>\n" + "      </assignedPerson>\n" + "      <!--建档医疗机构-->\n" + "      <representedOrganization quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_HZJBXX.jdzzjgmc\" cnName=\"建档医疗机构\">\n" + "        <id quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_HZJBXX.jdzzjgdm\" extension=\"$HLHT_YLJGXX_JBXX.yljgzzjgdm\" root=\"2.16.156.10011.1.5\" cnName=\"医疗机构组织机构标识\"/>\n" + "        <name cnName=\"医疗机构名称\">$VW_HLHT_BLGY_HZJBXX.jdzzjgmc</name>\n" + "      </representedOrganization>\n" + "    </assignedAuthor>\n" + "  </author>\n" + "  <!--文档管理机构信息-->\n" + "  <custodian typeCode=\"CST\" cnName=\"文档管理机构信息\">\n" + "    <assignedCustodian classCode=\"ASSIGNED\">\n" + "      <representedCustodianOrganization classCode=\"ORG\" determinerCode=\"INSTANCE\" cnName=\"保管维护的组织机构\">\n" + "        <id extension=\"$HLHT_YLJGXX_JBXX.yljgzzjgdm\" root=\"2.16.156.10011.1.5\" cnName=\"文档保管的医疗机构标识\"/>\n" + "        <name cnName=\"保管机构名称\">$VW_HLHT_BLGY_HZJBXX.jdzzjgmc</name>\n" + "      </representedCustodianOrganization>\n" + "    </assignedCustodian>\n" + "  </custodian>\n" + "  <!--联系人,问题:目前取患者信息字段，无独立字段-->\n" + "  <participant typeCode=\"NOT\" cnName=\"联系人\">\n" + "    <associatedEntity classCode=\"ECON\" cnName=\"服务者\">\n" + "      <code/>\n" + "      <!--联系人地址-->\n" + "      <addr quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_HZJBXX.dzmphm;VW_HLHT_BLGY_HZJBXX.dzc;VW_HLHT_BLGY_HZJBXX.dzxz;VW_HLHT_BLGY_HZJBXX.dzx;VW_HLHT_BLGY_HZJBXX.dzsq;VW_HLHT_BLGY_HZJBXX.dzsf\" cnName=\"联系人地址\">\n" + "        <houseNumber cnName=\"地址-门牌号码\">$VW_HLHT_BLGY_HZJBXX.lxrdzmphm</houseNumber>\n" + "        <streetName cnName=\"现住地址-村（街、路、弄等）\">$VW_HLHT_BLGY_HZJBXX.lxrdzc</streetName>\n" + "        <township cnName=\"地址-乡（镇、街道办事处）\">$VW_HLHT_BLGY_HZJBXX.lxrdzxz</township>\n" + "        <county cnName=\"地址-县（区）\">$VW_HLHT_BLGY_HZJBXX.lxrdzx</county>\n" + "        <city cnName=\"地址-市（地区）\">$VW_HLHT_BLGY_HZJBXX.lxrdzsq</city>\n" + "        <state cnName=\"地址-省（自治区、直辖市）\">$VW_HLHT_BLGY_HZJBXX.lxrdzsf</state>\n" + "        <postalCode quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_HZJBXX.yzbm\">$VW_HLHT_BLGY_HZJBXX.lxryzbm</postalCode>\n" + "      </addr>\n" + "      <!--联系人电话号码-->\n" + "      <telecom quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_HZJBXX.lxrhm\" use=\"H\" value=\"$VW_HLHT_BLGY_HZJBXX.lxrhm\" cnName=\"联系人电话号码\"/>\n" + "      <!--联系人姓名-->\n" + "      <associatedPerson quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_HZJBXX.lxrxm\" classCode=\"PSN\" determinerCode=\"INSTANCE\" cnName=\"联系人姓名\">\n" + "        <name>$VW_HLHT_BLGY_HZJBXX.lxrxm</name>\n" + "      </associatedPerson>\n" + "    </associatedEntity>\n" + "  </participant>\n" + "  <!--父文档信息-->\n" + "  <relatedDocument typeCode=\"RPLC\" cnName=\"父文档信息\">\n" + "    <parentDocument cnName=\"父文档\">\n" + "      <id cnName=\"父文档标识符\"/>\n" + "      <setId cnName=\"文档集序列号\"/>\n" + "      <versionNumber cnName=\"文档版本号\"/>\n" + "    </parentDocument>\n" + "  </relatedDocument>\n" + "  <component>\n" + "    <structuredBody>\n" + "      <!--实验室检查章节-->\n" + "      <component quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.aboxxmc;VW_HLHT_BLGY_JBJKXX.rhxxmc\" cnName=\"实验室检查章节\">\n" + "        <section>\n" + "          <code code=\"30954-2\" codeSystem=\"2.16.840.1.113883.6.1\" codeSystemName=\"LOINC\" displayName=\"STUDIES SUMMARY\" cnName=\"实验室检查章节代码\"/>\n" + "          <text cnName=\"人读部分\"/>\n" + "          <!--血型条目-->\n" + "          <entry typeCode=\"COMP\" cnName=\"血型条目\">\n" + "            <organizer classCode=\"BATTERY\" moodCode=\"EVN\" cnName=\"血型组合\">\n" + "              <statusCode cnName=\"状态标志\"/>\n" + "              <!--ABO血型-->\n" + "              <component contextConductionInd=\"true\" typeCode=\"COMP\" cnName=\"ABO血型\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\" cnName=\"ABO血型指标\">\n" + "                  <code code=\"DE04.50.001.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" cnName=\"ABO血型代码\"/>\n" + "                  <value code=\"$VW_HLHT_BLGY_JBJKXX.aboxxdm\" codeSystem=\"2.16.156.10011.2.3.1.85\" codeSystemName=\"ABO血型代码表\" displayName=\"$VW_HLHT_BLGY_JBJKXX.aboxxmc\" xsi:type=\"CD\" cnName=\"ABO血型值\"/>\n" + "                </observation>\n" + "              </component>\n" + "              <!--Rh血型-->\n" + "              <component contextConductionInd=\"true\" typeCode=\"COMP\" cnName=\"Rh血型\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\" cnName=\"Rh血型指标\">\n" + "                  <code code=\"DE04.50.010.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" cnName=\"Rh血型代码\"/>\n" + "                  <value code=\"$VW_HLHT_BLGY_JBJKXX.rhxxdm\" codeSystem=\"2.16.156.10011.2.3.1.250\" codeSystemName=\"Rh(D)血型代码表\" displayName=\"$VW_HLHT_BLGY_JBJKXX.rhxxmc\" xsi:type=\"CD\" cnName=\"Rh血型值\"/>\n" + "                </observation>\n" + "              </component>\n" + "            </organizer>\n" + "          </entry>\n" + "        </section>\n" + "      </component>\n" + "      <!--既往史章节-->\n" + "      <component quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.jbs;VW_HLHT_BLGY_JBJKXX.crbs;VW_HLHT_BLGY_JBJKXX.sss;VW_HLHT_BLGY_JBJKXX.hys\" cnName=\"既往史章节\">\n" + "        <section>\n" + "          <code code=\"11348-0\" codeSystem=\"2.16.840.1.113883.6.1\" codeSystemName=\"LOINC\" displayName=\"HISTORY OF PAST ILLNESS\" cnName=\"既往史章节代码\"/>\n" + "          <text cnName=\"人读部分\"/>\n" + "          <!--疾病史（含外伤）条目-->\n" + "          <entry quantity=\"1..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.jbs\" cnName=\"疾病史（含外伤）条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.10.026.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"疾病史（含外伤）\" cnName=\"既往史代码\"/>\n" + "              <value xsi:type=\"ST\">$VW_HLHT_BLGY_JBJKXX.jbs</value>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--传染病史条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.crbs\" cnName=\"传染病史条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.10.008.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"传染病史\" cnName=\"传染病史代码\"/>\n" + "              <value xsi:type=\"ST\">$VW_HLHT_BLGY_JBJKXX.crbs</value>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--手术史条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.sss\" cnName=\"手术史条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.10.061.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"手术史\" cnName=\"手术史代码\"/>\n" + "              <value xsi:type=\"ST\">$VW_HLHT_BLGY_JBJKXX.sss</value>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--婚育史条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.hys\" cnName=\"婚育史条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.10.098.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"婚育史\" cnName=\"婚育史代码\"/>\n" + "              <value xsi:type=\"ST\">$VW_HLHT_BLGY_JBJKXX.hys</value>\n" + "            </observation>\n" + "          </entry>\n" + "        </section>\n" + "      </component>\n" + "      <!--输血章节-->\n" + "      <component quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.sxs\" cnName=\"输血章节\">\n" + "        <section>\n" + "          <code code=\"56836-0\" codeSystem=\"2.16.840.1.113883.6.1\" codeSystemName=\"LOINC\" displayName=\"History of blood transfusion\" cnName=\"输血章节代码\"/>\n" + "          <text/>\n" + "          <!--输血史条目-->\n" + "          <entry cnName=\"输血史条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.10.100.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"输血史\"/>\n" + "              <value xsi:type=\"ST\" cnName=\"对患者既往输血史的详细描述\">$VW_HLHT_BLGY_JBJKXX.sxs</value>\n" + "            </observation>\n" + "          </entry>\n" + "        </section>\n" + "      </component>\n" + "      <!--过敏史章节-->\n" + "      <component quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.gms\" cnName=\"过敏史章节\">\n" + "        <section>\n" + "          <code code=\"48765-2\" codeSystem=\"2.16.840.1.113883.6.1\" codeSystemName=\"LOINC\" displayName=\"Allergies adverse reactions alerts\" cnName=\"过敏史章节代码\"/>\n" + "          <text/>\n" + "          <!--过敏史条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.gms\" cnName=\"过敏史条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.10.022.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"过敏史\"/>\n" + "              <value xsi:type=\"ST\" cnName=\"过敏史详细描述\">$VW_HLHT_BLGY_JBJKXX.gms</value>\n" + "            </observation>\n" + "          </entry>\n" + "        </section>\n" + "      </component>\n" + "      <!--预防接种史章节-->\n" + "      <component quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.yfjzs\" cnName=\"预防接种史章节\">\n" + "        <section>\n" + "          <code code=\"11369-6\" codeSystem=\"2.16.840.1.113883.6.1\" codeSystemName=\"LOINC\" displayName=\"HISTORY OF IMMUNIZATIONS\" cnName=\"预防接种史章节代码\"/>\n" + "          <text/>\n" + "          <!--预防接种条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.yfjzs\" cnName=\"预防接种条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.10.101.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"预防接种史\"/>\n" + "              <value xsi:type=\"ST\" cnName=\"预防接种史描述\">$VW_HLHT_BLGY_JBJKXX.yfjzs</value>\n" + "            </observation>\n" + "          </entry>\n" + "        </section>\n" + "      </component>\n" + "      <!--个人史章节-->\n" + "      <component quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.grs\" cnName=\"个人史章节\">\n" + "        <section>\n" + "          <code code=\"29762-2\" codeSystem=\"2.16.840.1.113883.6.1\" codeSystemName=\"LOINC\" displayName=\"Social history\" cnName=\"个人史章节代码\"/>\n" + "          <text/>\n" + "          <!--个人史条目-->\n" + "          <entry cnName=\"个人史条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.10.097.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"个人史\"/>\n" + "              <value xsi:type=\"ST\" cnName=\"患者个人史描述\">$VW_HLHT_BLGY_JBJKXX.grs</value>\n" + "            </observation>\n" + "          </entry>\n" + "        </section>\n" + "      </component>\n" + "      <!--月经史章节-->\n" + "      <component quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.yjs\" cnName=\"月经史章节\">\n" + "        <section>\n" + "          <code code=\"49033-4\" codeSystem=\"2.16.840.1.113883.6.1\" codeSystemName=\"LOINC\" displayName=\"Menstrual History\" cnName=\"月经史章节代码\"/>\n" + "          <text/>\n" + "          <!--月经史条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.yjs\" cnName=\"月经史条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.10.102.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"月经史\"/>\n" + "              <value xsi:type=\"ST\" cnName=\"对患者月经史的详细描述\">$VW_HLHT_BLGY_JBJKXX.yjs</value>\n" + "            </observation>\n" + "          </entry>\n" + "        </section>\n" + "      </component>\n" + "      <!--家族史章节-->\n" + "      <component cnName=\"家族史章节\">\n" + "        <section>\n" + "          <code code=\"10157-6\" codeSystem=\"2.16.840.1.113883.6.1\" codeSystemName=\"LOINC\" displayName=\"HISTORY OF FAMILY MEMBER DISEASES\" cnName=\"家族史章节代码\"/>\n" + "          <text/>\n" + "          <!--家族史条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_JBJKXX.jzs\" cnName=\"家族史条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.10.103.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"家族史\"/>\n" + "              <value xsi:type=\"ST\" cnName=\"对患者家族史的详细描述\">$VW_HLHT_BLGY_JBJKXX.jzs</value>\n" + "            </observation>\n" + "          </entry>\n" + "        </section>\n" + "      </component>\n" + "      <!--卫生事件章节-->\n" + "      <component cnName=\"卫生事件章节\">\n" + "        <section>\n" + "          <code displayName=\"卫生事件\"/>\n" + "          <text/>\n" + "          <!--医疗机构科室名称条目-->\n" + "          <entry cnName=\"医疗机构科室名称条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE08.10.026.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"医疗机构科室名称\"/>\n" + "              <value xsi:type=\"ST\">$VW_HLHT_BLGY_WSSJZY.ksmc</value>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--患者类型代码条目-->\n" + "          <entry cnName=\"患者类型代码条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.01.060.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"患者类型代码\" cnName=\"患者类型代码\"/>\n" + "              <value code=\"$VW_HLHT_BLGY_WSSJZY.hzlxdm\" codeSystem=\"2.16.156.10011.2.3.1.271\" codeSystemName=\"患者类型代码表\" displayName=\"$VW_HLHT_BLGY_WSSJZY.hzlxmc\" xsi:type=\"CD\"/>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--门（急）诊号条目-->\n" + "          <entry cnName=\"门（急）诊号条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE01.00.010.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"门（急）诊号\"/>\n" + "              <value xsi:type=\"ST\">$VW_HLHT_BLGY_WSSJZY.mjzh</value>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--住院号条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_WSSJZY.zyh\" cnName=\"住院号条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE01.00.014.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"住院号\"/>\n" + "              <value xsi:type=\"ST\">$VW_HLHT_BLGY_WSSJZY.zyh</value>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--出入院时间条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_WSSJZY.ryrqsj;VW_HLHT_BLGY_WSSJZY.cyrqsj\" cnName=\"出入院时间条目\">\n" + "            <organizer classCode=\"BATTERY\" moodCode=\"EVN\">\n" + "              <statusCode cnName=\"状态标志\"/>\n" + "              <component cnName=\"入院日期\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\" cnName=\"入院日期时间\">\n" + "                  <code code=\"DE06.00.092.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"入院日期时间\"/>\n" + "                  <value value=\"$VW_HLHT_BLGY_WSSJZY.ryrqsj$\" xsi:type=\"TS\"/>\n" + "                </observation>\n" + "              </component>\n" + "              <component cnName=\"出院日期\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\" cnName=\"出院日期时间\">\n" + "                  <code code=\"DE06.00.017.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"出院日期时间\"/>\n" + "                  <value value=\"$VW_HLHT_BLGY_WSSJZY.cyrqsj$\" xsi:type=\"TS\"/>\n" + "                </observation>\n" + "              </component>\n" + "            </organizer>\n" + "          </entry>\n" + "          <!--发病时间条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_WSSJZY.fbrqsj\" cnName=\"发病时间条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE04.01.018.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"发病日期时间\"/>\n" + "              <value value=\"$VW_HLHT_BLGY_WSSJZY.fbrqsj$\" xsi:type=\"TS\"/>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--就诊原因名称条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_WSSJZY.jzrqsj;VW_HLHT_BLGY_WSSJZY.jzyy\" cnName=\"就诊原因名称条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE05.10.053.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"就诊原因\"/>\n" + "              <effectiveTime value=\"$VW_HLHT_BLGY_WSSJZY.jzrqsj$\" cnName=\"就诊日期时间\"/>\n" + "              <value xsi:type=\"ST\">$VW_HLHT_BLGY_WSSJZY.jzyy</value>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--西医诊断编码条目-->\n" + "          <entry quantity=\"1..*\" dependency=\"VW_HLHT_BLGY_WSSJZY_XYZD\" cnName=\"西医诊断编码条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\" cnName=\"西医诊断\">\n" + "              <code code=\"DE05.01.024.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"西医诊断编码\">\n" + "                <qualifier>\n" + "                  <name displayName=\"西医诊断编码\"/>\n" + "                </qualifier>\n" + "              </code>\n" + "              <value code=\"$VW_HLHT_BLGY_WSSJZY_XYZD.xyzd\" codeSystem=\"2.16.156.10011.2.3.3.11\" codeSystemName=\"ICD-10\" displayName=\"$VW_HLHT_BLGY_WSSJZY_XYZD.xyzdmc\" xsi:type=\"CD\"/>\n" + "              <!--病情转归代码条目-->\n" + "              <entryRelationship typeCode=\"COMP\" cnName=\"病情转归代码条目\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "                  <code code=\"DE05.10.113.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"病情转归代码\"/>\n" + "                  <value code=\"$VW_HLHT_BLGY_WSSJZY_XYZD.zljg\" codeSystem=\"2.16.156.10011.2.3.1.148\" codeSystemName=\"病情转归代码表\" displayName=\"$VW_HLHT_BLGY_WSSJZY_XYZD.zljgmc\" xsi:type=\"CD\"/>\n" + "                </observation>\n" + "              </entryRelationship>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--其他西医诊断编码条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_WSSJZY.qtxyzdmc\" cnName=\"其他西医诊断编码条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE05.01.024.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"其他西医诊断编码\">\n" + "                <qualifier>\n" + "                  <name displayName=\"其他西医诊断编码\"/>\n" + "                </qualifier>\n" + "              </code>\n" + "              <value code=\"$VW_HLHT_BLGY_WSSJZY.qtxyzd\" codeSystem=\"2.16.156.10011.2.3.3.11\" codeSystemName=\"ICD-10\" displayName=\"$VW_HLHT_BLGY_WSSJZY.qtxyzdmc\" xsi:type=\"CD\"/>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--中医病名代码条目-->\n" + "          <entry quantity=\"0..*\" dependency=\"VW_HLHT_BLGY_WSSJZY_ZYZD\" cnName=\"中医病名代码条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE05.10.130.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"中医病名代码\">\n" + "                <qualifier>\n" + "                  <name displayName=\"中医病名代码\"/>\n" + "                </qualifier>\n" + "              </code>\n" + "              <value code=\"$VW_HLHT_BLGY_WSSJZY_ZYZD.zybm\" codeSystem=\"2.16.156.10011.2.3.3.14\" codeSystemName=\"中医病证分类与代码表( GB/T 15657)\" displayName=\"$VW_HLHT_BLGY_WSSJZY_ZYZD.zybmmc\" xsi:type=\"CD\"/>\n" + "              <!--中医证候代码条目-->\n" + "              <entryRelationship dependency=\"VW_HLHT_BLGY_WSSJZY_ZYZD.zyzhmc\" typeCode=\"COMP\" cnName=\"中医证候代码条目\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "                  <code code=\"DE05.10.130.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"中医证候代码\">\n" + "                    <qualifier>\n" + "                      <name displayName=\"中医证候代码\"/>\n" + "                    </qualifier>\n" + "                  </code>\n" + "                  <value code=\"$VW_HLHT_BLGY_WSSJZY_ZYZD.zyzh\" codeSystem=\"2.16.156.10011.2.3.3.14\" codeSystemName=\"中医病证分类与代码表( GB/T 15657)\" displayName=\"$VW_HLHT_BLGY_WSSJZY_ZYZD.zyzhmc\" xsi:type=\"CD\"/>\n" + "                </observation>\n" + "              </entryRelationship>\n" + "              <!--病情转归代码条目-->\n" + "              <entryRelationship dependency=\"VW_HLHT_BLGY_WSSJZY_ZYZD.zljgmc\" typeCode=\"COMP\" cnName=\"病情转归代码条目\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "                  <code code=\"DE05.10.113.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"病情转归代码\"/>\n" + "                  <value code=\"$VW_HLHT_BLGY_WSSJZY_ZYZD.zljg\" codeSystem=\"2.16.156.10011.2.3.1.148\" codeSystemName=\"病情转归代码表\" displayName=\"$VW_HLHT_BLGY_WSSJZY_ZYZD.zljgmc\" xsi:type=\"CD\"/>\n" + "                </observation>\n" + "              </entryRelationship>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--手术及操作编码条目-->\n" + "          <entry quantity=\"0..*\" dependency=\"VW_HLHT_BLGY_WSSJZY_SSCZ\" cnName=\"手术及操作编码条目\">\n" + "            <procedure classCode=\"PROC\" moodCode=\"EVN\">\n" + "              <code code=\"$VW_HLHT_BLGY_WSSJZY_SSCZ.ssjcz\" codeSystem=\"2.16.156.10011.2.3.3.12\" codeSystemName=\"手术(操作)代码表(ICD-9-CM)\" displayName=\"$VW_HLHT_BLGY_WSSJZY_SSCZ.ssjczmc\"/>\n" + "            </procedure>\n" + "          </entry>\n" + "          <!--关键药物名称条目-->\n" + "          <entry quantity=\"0..*\" dependency=\"VW_HLHT_BLGY_WSSJZY_GJYW\" cnName=\"关键药物名称条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE08.50.022.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"关键药物名称\"/>\n" + "              <value xsi:type=\"ST\">$VW_HLHT_BLGY_WSSJZY_GJYW.gjywmc</value>\n" + "              <!--关键药物用法-->\n" + "              <entryRelationship typeCode=\"COMP\" cnName=\"关键药物用法\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "                  <code code=\"DE06.00.136.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"关键药物用法\"/>\n" + "                  <value xsi:type=\"ST\">$VW_HLHT_BLGY_WSSJZY_GJYW.gjywyf</value>\n" + "                </observation>\n" + "              </entryRelationship>\n" + "              <!--药物不良反应情况-->\n" + "              <entryRelationship typeCode=\"COMP\" cnName=\"药物不良反应情况\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "                  <code code=\"DE06.00.129.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"药物不良反应情况\"/>\n" + "                  <value xsi:type=\"ST\">$VW_HLHT_BLGY_WSSJZY_GJYW.ywblfy</value>\n" + "                </observation>\n" + "              </entryRelationship>\n" + "              <!--中药使用类别代码条目-->\n" + "              <entryRelationship typeCode=\"COMP\" cnName=\"中药使用类别代码条目\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "                  <code code=\"DE06.00.164.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"中药使用类别代码\"/>\n" + "                  <value code=\"$VW_HLHT_BLGY_WSSJZY_GJYW.zysylb\" codeSystem=\"2.16.156.10011.2.3.1.157\" codeSystemName=\"中药使用类别代码表\" displayName=\"$VW_HLHT_BLGY_WSSJZY_GJYW.zysylbmc\" xsi:type=\"CD\"/>\n" + "                </observation>\n" + "              </entryRelationship>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--其他处置条目-->\n" + "          <entry cnName=\"其他处置条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE06.00.251.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"其他医学处置\"/>\n" + "              <value xsi:type=\"ST\">$VW_HLHT_BLGY_WSSJZY.qtyxcz</value>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--根本死因代码条目-->\n" + "          <entry quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_WSSJZY.gbsymc\" cnName=\"根本死因代码条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE05.01.021.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"根本死因代码\"/>\n" + "              <value code=\"$VW_HLHT_BLGY_WSSJZY.gbsy\" codeSystem=\"2.16.156.10011.2.3.3.11\" codeSystemName=\"ICD-10\" displayName=\"$VW_HLHT_BLGY_WSSJZY.gbsymc\" xsi:type=\"CD\"/>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--责任医师姓名条目-->\n" + "          <entry cnName=\"责任医师姓名条目\">\n" + "            <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "              <code code=\"DE02.01.039.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"责任医师姓名\"/>\n" + "              <value xsi:type=\"ST\">$VW_HLHT_BLGY_WSSJZY.zrys</value>\n" + "            </observation>\n" + "          </entry>\n" + "          <!--费用条目-->\n" + "          <entry cnName=\"费用条目\">\n" + "            <organizer classCode=\"CLUSTER\" moodCode=\"EVN\">\n" + "              <statusCode/>\n" + "              <!--医疗保险类别代码-->\n" + "              <component cnName=\"医疗保险类别代码\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "                  <code code=\"DE02.01.044.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"医疗保险类别代码\"/>\n" + "                  <value code=\"$VW_HLHT_BLGY_HZJBXX.yblbdm\" codeSystem=\"2.16.156.10011.2.3.1.248\" codeSystemName=\"医疗保险类别代码表\" displayName=\"$VW_HLHT_BLGY_HZJBXX.yblbmc\" xsi:type=\"CD\"/>\n" + "                </observation>\n" + "              </component>\n" + "              <!--医疗付费方式代码-->\n" + "              <component cnName=\"医疗付费方式代码\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "                  <code code=\"DE07.00.007.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"医疗付费方式代码\"/>\n" + "                  <value code=\"$VW_HLHT_BLGY_YLFYJL.ffdm\" codeSystem=\"2.16.156.10011.2.3.1.269\" codeSystemName=\"医疗付费方式代码表\" displayName=\"$VW_HLHT_BLGY_YLFYJL.fffs\" xsi:type=\"CD\"/>\n" + "                </observation>\n" + "              </component>\n" + "              <!--门诊费用金额 问题:单位currency无字段-->\n" + "              <component cnName=\"门诊费用金额\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "                  <code code=\"DE07.00.004.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"门诊费用金额\"/>\n" + "                  <value currency=\"元\" value=\"$VW_HLHT_BLGY_YLFYJL.mzfyje\" xsi:type=\"MO\"/>\n" + "                </observation>\n" + "              </component>\n" + "              <!--住院费用金额 问题:单位currency无字段-->\n" + "              <component quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_YLFYJL.zyfyje\" cnName=\"住院费用金额\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "                  <code code=\"DE07.00.010.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"住院费用金额\"/>\n" + "                  <value currency=\"元\" value=\"$VW_HLHT_BLGY_YLFYJL.zyfyje\" xsi:type=\"MO\"/>\n" + "                </observation>\n" + "              </component>\n" + "              <!--个人承担费用金额 问题:单位currency无字段-->\n" + "              <component quantity=\"0..1\" dependency=\"VW_HLHT_BLGY_YLFYJL.grcdfy\" cnName=\"个人承担费用金额\">\n" + "                <observation classCode=\"OBS\" moodCode=\"EVN\">\n" + "                  <code code=\"DE07.00.001.00\" codeSystem=\"2.16.156.10011.2.2.1\" codeSystemName=\"卫生信息数据元目录\" displayName=\"个人承担费用金额\"/>\n" + "                  <value currency=\"元\" value=\"$VW_HLHT_BLGY_YLFYJL.grcdfy\" xsi:type=\"MO\"/>\n" + "                </observation>\n" + "              </component>\n" + "            </organizer>\n" + "          </entry>\n" + "        </section>\n" + "      </component>\n" + "    </structuredBody>\n" + "  </component>\n" + "</ClinicalDocument>\n";
        Instant stime2 = Instant.now();
        String messageEn = encrypt(message);
        Instant etime2 = Instant.now();
        System.out.println(message + "\t加密后的字符串为:" + messageEn);
        Instant stime1 = Instant.now();
        String messageDe = decrypt(messageEn);
        Instant etime1 = Instant.now();


        System.out.println("还原后的字符串为:" + messageDe);
        log.debug("Normal===XXXXXXXXXXXXXXXXXXXX-:加密{}毫秒", Duration.between(stime2, etime2).toMillis());
        log.debug("Normal===XXXXXXXXXXXXXXXXXXXX-:解密{}毫秒", Duration.between(stime1, etime1).toMillis());
    }

    /**
     * 随机生成密钥对
     *
     * @throws NoSuchAlgorithmException
     */
    public static void genKeyPair() throws NoSuchAlgorithmException {
        // KeyPairGenerator类用于生成公钥和私钥对，基于RSA算法生成对象
        KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance("RSA");
        // 初始化密钥对生成器，密钥大小为96-1024位
        keyPairGen.initialize(1024, new SecureRandom());
        // 生成一个密钥对，保存在keyPair中
        KeyPair keyPair = keyPairGen.generateKeyPair();
        RSAPrivateKey privateKey = (RSAPrivateKey) keyPair.getPrivate();   // 得到私钥
        RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic();  // 得到公钥
        String publicKeyString = new String(encoder.encode(publicKey.getEncoded()));
        // 得到私钥字符串
        String privateKeyString = new String(encoder.encode((privateKey.getEncoded())));
        // 将公钥和私钥保存到Map
       /* keyMap.put(0,publicKeyString);  //0表示公钥
        keyMap.put(1,privateKeyString);  //1表示私钥*/
    }

    /**
     * RSA公钥加密
     *
     * @param str       加密字符串
     * @param publicKey 公钥
     * @return 密文
     * @throws Exception 加密过程中的异常信息
     */
    public static String encrypt(String str, String publicKey) throws DttException {
        try (ByteArrayOutputStream out = new ByteArrayOutputStream()) {

            //base64编码的公钥
            byte[] decoded = decoder.decode(publicKey);
            byte[] decryptedData;

            byte[] encryptedBytes = str.getBytes(StandardCharsets.UTF_8);
            int inputLen = encryptedBytes.length;

            //RSA加密
            RSAPublicKey pubKey = (RSAPublicKey) KeyFactory.getInstance("RSA").generatePublic(new X509EncodedKeySpec(decoded));
            Cipher cipher = Cipher.getInstance("RSA");
            cipher.init(Cipher.ENCRYPT_MODE, pubKey);
            //Get the key
            int offSet = 0;
            byte[] cache;
            int i = 0;

            // 对数据分段加密
            while (inputLen - offSet > 0) {
                if (inputLen - offSet > MAX_ENCRYPT_BLOCK) {
                    cache = cipher.doFinal(encryptedBytes, offSet, MAX_ENCRYPT_BLOCK);
                } else {
                    cache = cipher.doFinal(encryptedBytes, offSet, inputLen - offSet);
                }
                out.write(cache, 0, cache.length);
                i++;
                offSet = i * MAX_ENCRYPT_BLOCK;
            }
            decryptedData = out.toByteArray();


            return new String(encoder.encode(decryptedData), StandardCharsets.UTF_8);
        } catch (Exception e) {
            throw new DttException(e, "加密算法运行失败");
        }
    }

    /**
     * 默认RSA公钥加密
     *
     * @param str: 需要加密的字符串
     * @return String 密文
     * @author IceBlue
     * @date 2023/6/14 17:08
     **/
    public static String encrypt(String str) throws DttException {
        return encrypt(str, PUBLIC_KEY);
    }

    /**
     * RSA私钥解密
     *
     * @param str        加密字符串
     * @param privateKey 私钥
     * @return 明文
     * @throws Exception 解密过程中的异常信息
     */
    public static String decrypt(String str, String privateKey) throws DttException {
        //64位解码加密后的字符串
//		byte[] inputByte = Base64.decodeBase64(str.getBytes(StandardCharsets.UTF_8));

        byte[] inputByte = decoder.decode(str);
        //base64编码的私钥
//		byte[] decoded = Base64.decodeBase64(privateKey);
        byte[] decoded = decoder.decode(privateKey.getBytes(StandardCharsets.UTF_8));

        int inputLen = inputByte.length;
        byte[] decryptedData = new byte[0];

        try (ByteArrayOutputStream out = new ByteArrayOutputStream();) {
            int offSet1 = 0;
            byte[] cache1;
            int i = 0;

            RSAPrivateKey priKey = (RSAPrivateKey) KeyFactory.getInstance("RSA").generatePrivate(new PKCS8EncodedKeySpec(decoded));
            Cipher cipher = Cipher.getInstance("RSA");
            cipher.init(Cipher.DECRYPT_MODE, priKey);

            while (inputLen - offSet1 > 0) {
                if (inputLen - offSet1 > MAX_DECRYPT_BLOCK) {
                    cache1 = cipher.doFinal(inputByte, offSet1, MAX_DECRYPT_BLOCK);
                } else {
                    cache1 = cipher.doFinal(inputByte, offSet1, inputLen - offSet1);
                }
                out.write(cache1, 0, cache1.length);
                i++;
                offSet1 = i * MAX_DECRYPT_BLOCK;
            }
            decryptedData = out.toByteArray();
            return new String(decryptedData, StandardCharsets.UTF_8);
        } catch (Exception e) {
            throw new DttException(e, "解密算法运行失败");
        }
    }

    /**
     * 默认RSA私钥解密
     *
     * @param str: 密文字符串
     * @return String 明文
     * @author IceBlue
     * @date 2023/6/14 17:06
     **/
    public static String decrypt(String str) throws DttException {
        return decrypt(str, PRIVATE_KEY);
    }

}
